<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profil | Kelurahan Cakung Barat</title>
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* ====== Hero Profil Custom ====== */
    
    .hero-profile {
      background: #054569;
      color: white;
      text-align: center;
      padding: 100px 20px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      box-shadow: 0 -4px 10px rgba(0,0,0,0.1) inset; /* bayangan halus di bagian atas */
      position: relative;
    }

    .hero-profile::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 8px;
      background: linear-gradient(to bottom, rgba(0,0,0,0.2), transparent);
    }

    .hero-profile h2 {
      font-size: 2.2rem;
      margin-bottom: 15px;
      font-weight: 700;
    }

    .hero-profile p {
      font-size: 1.1rem;
      opacity: 0.9;
      max-width: 800px;
    }

    /* Tambah efek shadow pada navbar bawah */
    .navbar {
      box-shadow: 0 4px 10px rgba(0,0,0,0.50);
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="navbar">
    <div class="container">
      <div class="logo">
        <img src="assets/img/logo.png" alt="Logo">
        <span>Cakung Barat</span>
      </div>

      <nav class="nav-menu">
        <ul>
          <li><a href="index.html">Beranda</a></li>
          <li><a href="profil.html" class="active">Profil</a></li>
          <li><a href="pelayanan.html">Pelayanan</a></li>
          <li><a href="informasi.html">Informasi</a></li>
          <li><a href="galeri.html">Galeri</a></li>
          <li><a href="kontak.html">Kontak</a></li>
        </ul>
      </nav>

      <div class="nav-tools">
        <div class="search-box">
          <input type="text" id="search-input" placeholder="Cari...">
          <button id="search-btn"><i class="fa fa-search"></i></button>
        </div>

        <div class="translate">
          <button id="translate-btn"><i class="fa fa-globe"></i></button>
          <select id="language-select">
            <option value="id">Indonesia</option>
            <option value="en">English</option>
          </select>
        </div>
      </div>
    </div>
  </header>

  <!-- Profil Section -->
  <section class="hero">
    <div class="hero-content">
      <h1>Profil Kelurahan Cakung Barat</h1>
      <p>Mengenal lebih dekat Kelurahan Cakung Barat, dari Sejarah hingga Struktur Organisasi yang Melayani Masyarakat</p>
    </div>
  </section>

  <!-- Sejarah -->
  <section class="content-section">
    <div class="container">
      <h2 class="title-vertical">Sejarah</h2>
      <div class="content-box">
        <p>
          Wilayah Cakung berada di Kota Administrasi Jakarta Timur dan memiliki peran penting dalam perkembangan wilayah Jakarta. 
          Dahulu, Cakung Barat masih berupa lahan persawahan serta perkampungan dengan aktivitas utama pertanian. 
          Seiring berjalannya waktu, wilayah ini berkembang menjadi kawasan padat penduduk dengan beragam fasilitas umum 
          seperti sekolah, pasar, dan pusat pelayanan masyarakat.
        </p>
      </div>
    </div>
  </section>

  <!-- Perubahan Wilayah -->
  <section class="content-section">
    <div class="container">
      <h2 class="title-vertical">Perubahan Wilayah Administratif</h2>
      <div class="content-box">
        <p>
          Pada tahun 1981, terjadi perubahan batas wilayah di Provinsi DKI Jakarta yang menjadikan 
          Kelurahan Cakung Barat sebagai salah satu wilayah administratif baru. 
          Kelurahan ini berada di bawah Kecamatan Cakung, Jakarta Timur, dan terus mengalami perkembangan pesat 
          dalam berbagai sektor pemerintahan dan pelayanan publik.
        </p>
      </div>
    </div>
  </section>

  <!-- Struktur Organisasi -->
  <!-- Struktur Organisasi -->
<section class="content-section">
  <div class="container">
    <h2 class="title-horizontal">Struktur Organisasi Kelurahan Cakung Barat</h2>
    <div class="content-box structure-box" style="overflow-x:auto;">
      
      <!-- Struktur Organisasi Embedded -->
      <div style="background: linear-gradient(135deg, #1e5a7d 0%, #2d7ba5 100%); min-height: 800px; padding: 20px; position: relative;">
        <div class="logo" style="position: absolute; top: 20px; left: 20px; width: 80px; height: 80px; background: white; border-radius: 10px; padding: 5px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center;">
          <img src="assets/img/logo.png" alt="Logo Cakung Barat" style="width: 100%; height: 100%; object-fit: contain; border-radius: 8px;">
        </div>

        <div class="container" style="max-width: 1600px; margin: 0 auto; padding-top: 30px;">
          <div class="org-chart" id="orgChart" style="position: relative; padding: 50px 20px; min-height: 900px; overflow-x: auto; overflow-y: visible; white-space: nowrap;">
            <svg id="linesSVG" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1;"></svg>
          </div>
        </div>

        <!-- Modal Edit -->
        <div class="modal" id="editModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center;">
          <div class="modal-content" style="background: white; border-radius: 15px; padding: 30px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header" style="font-size: 20px; font-weight: bold; margin-bottom: 20px; color: #2d7ba5;">Edit Anggota</div>
            <form id="editForm">
              <div class="form-group" style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Foto</label>
                <div class="photo-upload" onclick="document.getElementById('photoInput').click()" style="border: 2px dashed #ddd; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s;">
                  <div class="photo-preview" id="photoPreview" style="width: 120px; height: 120px; margin: 10px auto; border-radius: 50%; overflow: hidden; border: 3px solid #2d7ba5; display: none;">
                    <img id="previewImg" src="" alt="" style="width: 100%; height: 100%; object-fit: cover;">
                  </div>
                  <p>Klik untuk upload foto</p>
                  <input type="file" id="photoInput" accept="image/*" style="display: none;">
                </div>
                <div class="checkbox-group" style="display: flex; align-items: center; gap: 8px; margin-top: 10px;">
                  <input type="checkbox" id="removeBg" style="width: auto;">
                  <label for="removeBg" style="margin: 0;">Remove Background</label>
                </div>
              </div>

              <div class="form-group" style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Nama</label>
                <input type="text" id="memberName" placeholder="Masukkan nama" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px;">
              </div>

              <div class="form-group" style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Jabatan</label>
                <textarea id="memberPosition" rows="2" placeholder="Masukkan jabatan" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px;"></textarea>
              </div>

              <input type="hidden" id="memberId">

              <div class="btn-group" style="display: flex; gap: 10px; margin-top: 20px;">
                <button type="button" class="btn btn-danger" id="btnDelete" style="flex: 1; padding: 12px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s; background: #dc3545; color: white;">Hapus</button>
                <button type="button" class="btn btn-secondary" id="btnCancel" style="flex: 1; padding: 12px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s; background: #e0e0e0; color: #333;">Batal</button>
                <button type="submit" class="btn btn-primary" style="flex: 1; padding: 12px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s; background: #2d7ba5; color: white;">Simpan</button>
              </div>
            </form>
          </div>
        </div>
      </div>

    </div>
  </div>
</section>

<script>
// Data struktur organisasi
let orgData = [
  // Level 0: Lurah
  { id: 1, name: "", position: "PJS LURAH\nKELURAHAN CAKUNG BARAT", photo: "", parentId: null, x: 600, y: 30 },

  // Level 1: Sekretaris
  { id: 2, name: "", position: "SEKRETARIS\nKELURAHAN CAKUNG BARAT", photo: "", parentId: 1, x: 1050, y: 180, branch: "right" },

  // Level 2: Bendahara & Pengurus
  { id: 3, name: "", position: "BENDAHARA", photo: "", parentId: 2, x: 920, y: 380 },
  { id: 4, name: "", position: "PENGURUS BARANG", photo: "", parentId: 2, x: 1180, y: 380 },

  // Level 1-2: 3 Kasi
  { id: 5, name: "", position: "KASI PEMERINTAHAN", photo: "", parentId: 1, x: 80, y: 380, branch: "left" },
  { id: 6, name: "", position: "KASI EKONOMI\nPEMBANGUNAN", photo: "", parentId: 1, x: 370, y: 380, branch: "middle" },
  { id: 7, name: "", position: "KASI KESEJAHTERAAN\nRAKYAT", photo: "", parentId: 1, x: 660, y: 380, branch: "middle" },

  // Level 3: Staff
  { id: 8, name: "", position: "STAF PEMERINTAHAN", photo: "", parentId: 5, x: 80, y: 600 },
  { id: 9, name: "", position: "STAF EKONOMI\nPEMBANGUNAN", photo: "", parentId: 6, x: 370, y: 600 },
  { id: 10, name: "", position: "STAF KESEJAHTERAAN\nRAKYAT", photo: "", parentId: 7, x: 660, y: 600 }
];

let currentEditId = null;

/* === Render struktur (buat kartu dan garis) === */
function renderChart() {
  const chart = document.getElementById('orgChart');
  chart.querySelectorAll('.member-card').forEach(c => c.remove());

  orgData.forEach(member => {
    const card = document.createElement('div');
    card.className = member.name ? 'member-card' : 'member-card empty';
    card.dataset.id = member.id;
    card.style.left = member.x + 'px';
    card.style.top = member.y + 'px';
    card.style.position = 'absolute';
    card.style.background = 'white';
    card.style.borderRadius = '15px';
    card.style.padding = '14px';
    card.style.boxShadow = '0 6px 12px rgba(0,0,0,0.15)';
    card.style.textAlign = 'center';
    card.style.cursor = 'pointer';
    card.style.transition = 'all 0.3s ease';
    card.style.zIndex = '2';
    card.style.width = '200px';
    card.style.minHeight = '80px';
    card.style.height = 'auto';
    card.style.display = 'inline-block';
    card.style.whiteSpace = 'normal';
    card.style.overflowWrap = 'break-word';
    card.style.wordBreak = 'break-word';
    
    card.onclick = () => openEditModal(member.id);

    card.innerHTML = `
      <div class="photo-container ${!member.photo ? 'empty' : ''}" style="width: 80px; height: 80px; margin: 0 auto 10px; border-radius: 50%; overflow: hidden; border: 3px solid #2d7ba5; background: #e0e0e0; display: flex; align-items: center; justify-content: center;">
        ${member.photo ? `<img src="${member.photo}" alt="${member.name}" style="width: 100%; height: 100%; object-fit: cover; display: block;">` : '+'}
      </div>
      <div class="member-name" style="font-weight: 700; font-size: 13px; margin-bottom: 6px; color: #333; min-height: 20px;">${member.name || 'Klik untuk isi'}</div>
      <div class="member-position" style="font-size: 12px; color: #666; line-height: 1.3; white-space: normal; overflow-wrap: anywhere; word-break: break-word; display: block; margin-top: 4px;">${member.position.replace(/\\n/g, '<br>')}</div>
    `;

    chart.appendChild(card);
  });

  drawLines();
}

/* === Gambar garis antar elemen === */
function drawLines() {
  const chart = document.getElementById('orgChart');
  const svg = document.getElementById('linesSVG');
  svg.innerHTML = '';

  // Set lebar & tinggi SVG sesuai area konten
  const width = Math.max(chart.scrollWidth, chart.clientWidth);
  const height = Math.max(chart.scrollHeight, chart.clientHeight);
  svg.setAttribute('width', width);
  svg.setAttribute('height', height);
  svg.style.width = width + 'px';
  svg.style.height = height + 'px';

  const makeLine = (x1, y1, x2, y2) => {
    const l = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    l.setAttribute('x1', x1);
    l.setAttribute('y1', y1);
    l.setAttribute('x2', x2);
    l.setAttribute('y2', y2);
    l.setAttribute('stroke', 'white');
    l.setAttribute('stroke-width', '2');
    l.setAttribute('stroke-linecap', 'round');
    svg.appendChild(l);
  };

  const getCenter = (id) => {
    const el = chart.querySelector(`.member-card[data-id="${id}"]`);
    if (!el) return { x: 0, y: 0 };
    const rect = el.getBoundingClientRect();
    const chartRect = chart.getBoundingClientRect();
    return {
      x: (rect.left - chartRect.left) + chart.scrollLeft + rect.width / 2,
      y: (rect.top - chartRect.top) + chart.scrollTop + rect.height / 2
    };
  };

  // ambil titik-titik penting
  const L = getCenter(1);
  const S = getCenter(2);
  const B = getCenter(3);
  const P = getCenter(4);
  const K1 = getCenter(5);
  const K2 = getCenter(6);
  const K3 = getCenter(7);
  const ST1 = getCenter(8);
  const ST2 = getCenter(9);
  const ST3 = getCenter(10);

  const splitY = L.y + 120;

  // Lurah ke split
  makeLine(L.x, L.y + 40, L.x, splitY);

  // Lurah -> Sekretaris
  makeLine(L.x, splitY, S.x, splitY);
  makeLine(S.x, splitY, S.x, S.y - 40);

  // Sekretaris -> Bendahara & Pengurus
  const midY2 = (S.y + B.y) / 2;
  makeLine(S.x, S.y + 40, S.x, midY2);
  makeLine(B.x, midY2, P.x, midY2);
  makeLine(B.x, midY2, B.x, B.y - 40);
  makeLine(P.x, midY2, P.x, P.y - 40);

  // Lurah -> 3 Kasi
  makeLine(K1.x, splitY, K3.x, splitY);
  makeLine(K1.x, splitY, K1.x, K1.y - 40);
  makeLine(K2.x, splitY, K2.x, K2.y - 40);
  makeLine(K3.x, splitY, K3.x, K3.y - 40);

  // Kasi -> Staff
  const midStaffY = (K1.y + ST1.y) / 2;
  makeLine(ST1.x, midStaffY, ST3.x, midStaffY);
  makeLine(K1.x, K1.y + 40, ST1.x, midStaffY);
  makeLine(K2.x, K2.y + 40, ST2.x, midStaffY);
  makeLine(K3.x, K3.y + 40, ST3.x, midStaffY);
  makeLine(ST1.x, midStaffY, ST1.x, ST1.y - 40);
  makeLine(ST2.x, midStaffY, ST2.x, ST2.y - 40);
  makeLine(ST3.x, midStaffY, ST3.x, ST3.y - 40);
}

/* === Modal edit === */
function openEditModal(memberId) {
  const member = orgData.find(m => m.id === memberId);
  currentEditId = memberId;

  document.getElementById('memberId').value = memberId;
  document.getElementById('memberName').value = member.name;
  document.getElementById('memberPosition').value = member.position.replace(/\\n/g, '\n');

  if (member.photo) {
    document.getElementById('previewImg').src = member.photo;
    document.getElementById('photoPreview').style.display = 'block';
  } else {
    document.getElementById('photoPreview').style.display = 'none';
  }

  document.getElementById('editModal').style.display = 'flex';
}

/* === Event listeners === */
document.getElementById('photoInput').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById('previewImg').src = e.target.result;
      document.getElementById('photoPreview').style.display = 'block';
    };
    reader.readAsDataURL(file);
  }
});

document.getElementById('editForm').addEventListener('submit', function(e) {
  e.preventDefault();

  const memberId = parseInt(document.getElementById('memberId').value);
  const member = orgData.find(m => m.id === memberId);

  member.name = document.getElementById('memberName').value;
  member.position = document.getElementById('memberPosition').value.replace(/\n/g, '\\n');
  const photoPreview = document.getElementById('previewImg').src;
  if (photoPreview && photoPreview !== '' && !photoPreview.includes('data:,')) {
    member.photo = photoPreview;
  }

  document.getElementById('editModal').style.display = 'none';
  renderChart();
});

document.getElementById('btnCancel').addEventListener('click', () => {
  document.getElementById('editModal').style.display = 'none';
});

document.getElementById('btnDelete').addEventListener('click', () => {
  if (confirm('Hapus foto dan reset data anggota ini?')) {
    const memberId = parseInt(document.getElementById('memberId').value);
    const member = orgData.find(m => m.id === memberId);
    member.name = '';
    member.photo = '';
    document.getElementById('editModal').style.display = 'none';
    renderChart();
  }
});

document.getElementById('editModal').addEventListener('click', function(e) {
  if (e.target === this) this.style.display = 'none';
});

/* === Render awal dan auto redraw === */
window.addEventListener('load', () => {
  renderChart();
  setTimeout(drawLines, 200);
});

window.addEventListener('resize', drawLines);
document.getElementById('orgChart').addEventListener('scroll', drawLines);
</script>

  <!-- Footer -->
<footer>
  <div class="container footer-grid">
    <div>
      <h4>Kelurahan Cakung Barat</h4>
      <p>Jl Tipar Cakung Pool PPD Depo C RT.02/07<br>Kecamatan Cakung, Jakarta Timur 13910</p>
    </div>
    <div>
      <h4>Tautan Terkait</h4>
      <ul>
        <li><a href="https://jakarta.go.id" target="_blank">Portal DKI Jakarta</a></li>
        <li><a href="https://timur.jakarta.go.id/kecamatan/Cakung" target="_blank">Kecamatan Cakung</a></li>
      </ul>
    </div>
    <div>
      <h4>Hubungi Kami</h4>
      <p>Email: cakungbarat.64@gmail.com<br>Telp: (021) 4601748</p>
    </div>
  </div>
  <p class="copyright">Â© 2025 Kelurahan Cakung Barat</p>
</footer>

  <!-- Chatbot -->
  <div class="chatbot">
    <img src="assets/img/chat-icon.png" alt="Chat" id="chat-toggle">
    <div class="chat-window" id="chat-window">
      <div class="chat-header">
        <h4>Chatbot Cakung Barat</h4>
        <button id="chat-close">&times;</button>
      </div>
      <div class="chat-body" id="chat-body">
        <div class="bot-message">Halo! Ada yang bisa kami bantu?</div>
      </div>
      <div class="chat-input">
        <input type="text" id="chat-input" placeholder="Ketik pesan...">
        <button id="send-btn">Kirim</button>
      </div>
    </div>
  </div>

  <script src="assets/js/script.js"></script>
</body>
</html>
