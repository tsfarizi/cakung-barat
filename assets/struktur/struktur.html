<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Struktur Organisasi Kelurahan Cakung Barat</title>
    <style>
        /* --- Member card: flexible height + wrapping text --- */
.member-card {
    position: absolute;
    background: white;
    border-radius: 15px;
    padding: 14px;
    box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 2;
    width: 200px;            /* lebarkan sedikit agar teks muat */
    min-height: 80px;        /* minimal tinggi */
    height: auto;            /* biarkan menyesuaikan konten */
    display: inline-block;   /* supaya ukuran mengikuti konten */
    white-space: normal;     /* penting: membungkus teks */
    overflow-wrap: break-word;
    word-break: break-word;
}

/* Hover tetap oke */
.member-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.25);
}

/* Photo container tetap bundar */
.photo-container {
    width: 80px;
    height: 80px;
    margin: 0 auto 10px;
    border-radius: 50%;
    overflow: hidden;
    border: 3px solid #2d7ba5;
    background: #e0e0e0;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Pastikan gambar fill area tanpa merusak rasio */
.photo-container img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* tetap gunakan cover */
    display: block;
}

/* Nama */
.member-name {
    font-weight: 700;
    font-size: 13px;
    margin-bottom: 6px;
    color: #333;
    min-height: 20px;
}

/* Jabatan / posisi: bungkus & lebih readable */
.member-position {
    font-size: 12px;
    color: #666;
    line-height: 1.3;
    white-space: normal;        /* pastikan teks bisa pecah baris */
    overflow-wrap: anywhere;    /* pecah kata jika perlu */
    word-break: break-word;
    display: block;
    margin-top: 4px;
}

/* untuk kartu kosong */
.member-card.empty .member-position {
    color: rgba(0,0,0,0.6);
}

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            overflow-x: auto;
            overflow-y: auto;
            zoom: 1;
            transform: none;
            }


            

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e5a7d 0%, #2d7ba5 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        .logo {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 10px;
            padding: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            }

            .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 8px;
            }


        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding-top: 30px;
        }

        svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .org-chart {
            position: relative;
            padding: 50px 20px;
            min-height: 900px;
            overflow-x: auto;   /* âœ… bisa geser ke kanan-kiri */
            overflow-y: visible;
            white-space: nowrap; /* biar elemen tidak pecah baris */
        }


        .member-card {
            position: absolute;
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 2;
            width: 160px;
        }

        .member-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.25);
        }

        .member-card.empty {
            border: 2px dashed #ccc;
            background: rgba(255,255,255,0.5);
        }

        .member-card.empty:hover {
            background: rgba(255,255,255,0.8);
            border-color: #2d7ba5;
        }

        .photo-container {
            width: 80px;
            height: 80px;
            margin: 0 auto 10px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid #2d7ba5;
            background: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .photo-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-container.empty {
            background: #f5f5f5;
            border: 2px dashed #ccc;
            font-size: 30px;
            color: #999;
        }

        .member-name {
            font-weight: bold;
            font-size: 13px;
            margin-bottom: 5px;
            color: #333;
            min-height: 18px;
        }

        .member-position {
            font-size: 10px;
            color: #666;
            line-height: 1.3;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #2d7ba5;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #2d7ba5;
        }

        .photo-upload {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .photo-upload:hover {
            border-color: #2d7ba5;
            background: #f5f5f5;
        }

        .photo-preview {
            width: 120px;
            height: 120px;
            margin: 10px auto;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid #2d7ba5;
            display: none;
        }

        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-preview.active {
            display: block;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #2d7ba5;
            color: white;
        }

        .btn-primary:hover {
            background: #1e5a7d;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #ccc;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
        }
    </style>
</head>
<body>
    <div class="logo">
    <img src="../img/logo.png" alt="Logo Cakung Barat">
    </div>


    <div class="container">
        <div class="org-chart" id="orgChart">
            <svg id="linesSVG"></svg>
        </div>
    </div>

    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">Edit Anggota</div>
            <form id="editForm">
                <div class="form-group">
                    <label>Foto</label>
                    <div class="photo-upload" onclick="document.getElementById('photoInput').click()">
                        <div class="photo-preview" id="photoPreview">
                            <img id="previewImg" src="" alt="">
                        </div>
                        <p>Klik untuk upload foto</p>
                        <input type="file" id="photoInput" accept="image/*" style="display: none;">
                    </div>
                    <div class="checkbox-group" style="margin-top: 10px;">
                        <input type="checkbox" id="removeBg">
                        <label for="removeBg" style="margin: 0;">Remove Background</label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Nama</label>
                    <input type="text" id="memberName" placeholder="Masukkan nama">
                </div>

                <div class="form-group">
                    <label>Jabatan</label>
                    <textarea id="memberPosition" rows="2" placeholder="Masukkan jabatan" required></textarea>
                </div>

                <input type="hidden" id="memberId">

                <div class="btn-group">
                    <button type="button" class="btn btn-danger" id="btnDelete">Hapus</button>
                    <button type="button" class="btn btn-secondary" id="btnCancel">Batal</button>
                    <button type="submit" class="btn btn-primary">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <script>
/* ===============================
   STRUKTUR ORGANISASI CAKUNG BARAT
   Fixed: garis lengkap + scroll + posisi teks + auto-resize
   =============================== */

let orgData = [
  // Level 0: Lurah
  { id: 1, name: "", position: "PJS LURAH\nKELURAHAN CAKUNG BARAT", photo: "", parentId: null, x: 600, y: 30 },

  // Level 1: Sekretaris
  { id: 2, name: "", position: "SEKRETARIS\nKELURAHAN CAKUNG BARAT", photo: "", parentId: 1, x: 1050, y: 180, branch: "right" },

  // Level 2: Bendahara & Pengurus
  { id: 3, name: "", position: "BENDAHARA", photo: "", parentId: 2, x: 920, y: 380 },
  { id: 4, name: "", position: "PENGURUS BARANG", photo: "", parentId: 2, x: 1180, y: 380 },

  // Level 1-2: 3 Kasi
  { id: 5, name: "", position: "KASI PEMERINTAHAN", photo: "", parentId: 1, x: 80, y: 380, branch: "left" },
  { id: 6, name: "", position: "KASI EKONOMI\nPEMBANGUNAN", photo: "", parentId: 1, x: 370, y: 380, branch: "middle" },
  { id: 7, name: "", position: "KASI KESEJAHTERAAN\nRAKYAT", photo: "", parentId: 1, x: 660, y: 380, branch: "middle" },

  // Level 3: Staff
  { id: 8, name: "", position: "STAF PEMERINTAHAN", photo: "", parentId: 5, x: 80, y: 600 },
  { id: 9, name: "", position: "STAF EKONOMI\nPEMBANGUNAN", photo: "", parentId: 6, x: 370, y: 600 },
  { id: 10, name: "", position: "STAF KESEJAHTERAAN\nRAKYAT", photo: "", parentId: 7, x: 660, y: 600 }
];

let currentEditId = null;

/* === Render struktur (buat kartu dan garis) === */
function renderChart() {
  const chart = document.getElementById('orgChart');
  chart.querySelectorAll('.member-card').forEach(c => c.remove());

  orgData.forEach(member => {
    const card = document.createElement('div');
    card.className = member.name ? 'member-card' : 'member-card empty';
    card.dataset.id = member.id;
    card.style.left = member.x + 'px';
    card.style.top = member.y + 'px';
    card.onclick = () => openEditModal(member.id);

    card.innerHTML = `
      <div class="photo-container ${!member.photo ? 'empty' : ''}">
        ${member.photo ? `<img src="${member.photo}" alt="${member.name}">` : '+'}
      </div>
      <div class="member-name">${member.name || 'Klik untuk isi'}</div>
      <div class="member-position">${member.position.replace(/\\n/g, '<br>')}</div>
    `;

    chart.appendChild(card);
  });

  drawLines();
}

/* === Gambar garis antar elemen === */
function drawLines() {
  const chart = document.getElementById('orgChart');
  const svg = document.getElementById('linesSVG');
  svg.innerHTML = '';

  // Set lebar & tinggi SVG sesuai area konten
  const width = Math.max(chart.scrollWidth, chart.clientWidth);
  const height = Math.max(chart.scrollHeight, chart.clientHeight);
  svg.setAttribute('width', width);
  svg.setAttribute('height', height);
  svg.style.width = width + 'px';
  svg.style.height = height + 'px';

  const makeLine = (x1, y1, x2, y2) => {
    const l = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    l.setAttribute('x1', x1);
    l.setAttribute('y1', y1);
    l.setAttribute('x2', x2);
    l.setAttribute('y2', y2);
    l.setAttribute('stroke', 'white');
    l.setAttribute('stroke-width', '2');
    l.setAttribute('stroke-linecap', 'round');
    svg.appendChild(l);
  };

  const getCenter = (id) => {
    const el = chart.querySelector(`.member-card[data-id="${id}"]`);
    if (!el) return { x: 0, y: 0 };
    const rect = el.getBoundingClientRect();
    const chartRect = chart.getBoundingClientRect();
    return {
      x: (rect.left - chartRect.left) + chart.scrollLeft + rect.width / 2,
      y: (rect.top - chartRect.top) + chart.scrollTop + rect.height / 2
    };
  };

  // ambil titik-titik penting
  const L = getCenter(1);
  const S = getCenter(2);
  const B = getCenter(3);
  const P = getCenter(4);
  const K1 = getCenter(5);
  const K2 = getCenter(6);
  const K3 = getCenter(7);
  const ST1 = getCenter(8);
  const ST2 = getCenter(9);
  const ST3 = getCenter(10);

  const splitY = L.y + 120;

  // Lurah ke split
  makeLine(L.x, L.y + 40, L.x, splitY);

  // Lurah -> Sekretaris
  makeLine(L.x, splitY, S.x, splitY);
  makeLine(S.x, splitY, S.x, S.y - 40);

  // Sekretaris -> Bendahara & Pengurus
  const midY2 = (S.y + B.y) / 2;
  makeLine(S.x, S.y + 40, S.x, midY2);
  makeLine(B.x, midY2, P.x, midY2);
  makeLine(B.x, midY2, B.x, B.y - 40);
  makeLine(P.x, midY2, P.x, P.y - 40);

  // Lurah -> 3 Kasi
  makeLine(K1.x, splitY, K3.x, splitY);
  makeLine(K1.x, splitY, K1.x, K1.y - 40);
  makeLine(K2.x, splitY, K2.x, K2.y - 40);
  makeLine(K3.x, splitY, K3.x, K3.y - 40);

  // Kasi -> Staff
  const midStaffY = (K1.y + ST1.y) / 2;
  makeLine(ST1.x, midStaffY, ST3.x, midStaffY);
  makeLine(K1.x, K1.y + 40, ST1.x, midStaffY);
  makeLine(K2.x, K2.y + 40, ST2.x, midStaffY);
  makeLine(K3.x, K3.y + 40, ST3.x, midStaffY);
  makeLine(ST1.x, midStaffY, ST1.x, ST1.y - 40);
  makeLine(ST2.x, midStaffY, ST2.x, ST2.y - 40);
  makeLine(ST3.x, midStaffY, ST3.x, ST3.y - 40);
}

/* === Modal edit === */
function openEditModal(memberId) {
  const member = orgData.find(m => m.id === memberId);
  currentEditId = memberId;

  document.getElementById('memberId').value = memberId;
  document.getElementById('memberName').value = member.name;
  document.getElementById('memberPosition').value = member.position.replace(/\\n/g, '\n');

  if (member.photo) {
    document.getElementById('previewImg').src = member.photo;
    document.getElementById('photoPreview').classList.add('active');
  } else {
    document.getElementById('photoPreview').classList.remove('active');
  }

  document.getElementById('editModal').classList.add('active');
}

/* === Event listeners === */
document.getElementById('photoInput').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById('previewImg').src = e.target.result;
      document.getElementById('photoPreview').classList.add('active');
    };
    reader.readAsDataURL(file);
  }
});

document.getElementById('editForm').addEventListener('submit', function(e) {
  e.preventDefault();

  const memberId = parseInt(document.getElementById('memberId').value);
  const member = orgData.find(m => m.id === memberId);

  member.name = document.getElementById('memberName').value;
  member.position = document.getElementById('memberPosition').value.replace(/\n/g, '\\n');
  const photoPreview = document.getElementById('previewImg').src;
  if (photoPreview && photoPreview !== '' && !photoPreview.includes('data:,')) {
    member.photo = photoPreview;
  }

  document.getElementById('editModal').classList.remove('active');
  renderChart();
});

document.getElementById('btnCancel').addEventListener('click', () => {
  document.getElementById('editModal').classList.remove('active');
});

document.getElementById('btnDelete').addEventListener('click', () => {
  if (confirm('Hapus foto dan reset data anggota ini?')) {
    const memberId = parseInt(document.getElementById('memberId').value);
    const member = orgData.find(m => m.id === memberId);
    member.name = '';
    member.photo = '';
    document.getElementById('editModal').classList.remove('active');
    renderChart();
  }
});

document.getElementById('editModal').addEventListener('click', function(e) {
  if (e.target === this) this.classList.remove('active');
});

/* === Render awal dan auto redraw === */
window.addEventListener('load', () => {
  renderChart();
  setTimeout(drawLines, 200);
});

window.addEventListener('resize', drawLines);
document.getElementById('orgChart').addEventListener('scroll', drawLines);

/* === Kirim tinggi ke parent (profil.html) === */
function sendSizeToParent() {
  const height = document.body.scrollHeight;
  window.parent.postMessage({
    type: 'strukturSize',
    height: height
  }, '*');
}

let lastHeight = 0;
function checkHeightChange() {
  const newHeight = document.body.scrollHeight;
  if (newHeight !== lastHeight) {
    lastHeight = newHeight;
    sendSizeToParent();
  }
}

window.addEventListener('load', () => {
  checkHeightChange();
  setTimeout(checkHeightChange, 500); // update awal
});

window.addEventListener('resize', checkHeightChange);

</script>


<script>
window.addEventListener("load", function() {
  const body = document.body;
  const html = document.documentElement;
  const height = Math.max(body.scrollHeight, html.scrollHeight);
  const width = Math.max(body.scrollWidth, html.scrollWidth);

  // kirim ukuran ke profil.html
  window.parent.postMessage({
    type: "strukturSize",
    height: height + 50, // tambahkan sedikit jarak bawah
    width: width
  }, "*");
});
</script>

</body>
</html>